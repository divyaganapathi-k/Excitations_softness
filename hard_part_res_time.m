clearvars -except phop_all H R radial_density req_coord_soft
phop_all(:,1)=ceil(phop_all(:,1)*10000)/10000;
phop_all(:,2)=ceil(phop_all(:,2)*10000)/10000;
H(:,1)=ceil(H(:,1)*10000)/10000;
H(:,2)=ceil(H(:,2)*10000)/10000;
R(:,1)=ceil(R(:,1)*10000)/10000;
R(:,2)=ceil(R(:,2)*10000)/10000;
radial_density(:,1)=ceil(radial_density(:,1)*10000)/10000;
radial_density(:,2)=ceil(radial_density(:,2)*10000)/10000;
phop_all=phop_all(:,1:5);
deltat=32;
pth=0.135;
[pks(:,1),pks(:,2)]=findpeaks(phop_all(:,5));
f=pks(:,2)>pth;
phop_required=phop_all(pks(f,2),:);
phop_required1=circshift(phop_required,1);
diff=phop_required-phop_required1; 
phop_required=horzcat(phop_required,diff(:,3:4));
f=(phop_required(:,7)==0 & phop_required(:,6)>0);
phop_required=phop_required(f,:);
% phop_required=sortrows(phop_required,-6);
% phop_hard=phop_required(1:600,:);
% phop_hard=phop_hard(:,1:5);
[~,ia,ib]=intersect(phop_required(:,1:4),H(:,1:4),'rows');
req_coord_hard1=horzcat(R(ib,:),phop_required(ia,6:7));
[~,ia,ib]=intersect(req_coord_hard1(:,[1 2 4]),radial_density(:,2:4),'rows');
req_coord_hard1=horzcat(req_coord_hard1(ia,:),radial_density(ib,5:end));
req_coord_hard1(:,end+1)=-1;
req_coord_hard1=sortrows(req_coord_hard1,-6);
req_coord_hard=req_coord_hard1(1:600,:);
req_coord_hard(:,3)=[];
req_coord_hard(:,4:7)=[];